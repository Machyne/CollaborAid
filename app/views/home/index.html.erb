<%= stylesheet_link_tag "home", media: "all", "data-turbolinks-track" => true %>
<div class="container" id="home-cont">
  <div class="row">
    <div class="col-md-12">
      <h1>Welcome to CollaborAid!</h1>
    </div>
  </div>
  <div class="row map-row">
    <div class="col-md-12">
      <div id="map">
        <div id="searchbar">
          <form role="search" amethod="post" aaction="/search">
            <div class="input-group">
              <input type="text" class="form-control" placeholder="Search" name="srch-term" id="srch-term">
              <div class="input-group-btn">
                  <button class="btn btn-default" type="submit"><i class="glyphicon glyphicon-search"></i></button>
              </div>
            </div>
            <div id="fullform" class="collapse">
              <div class="input-group">
                <h2>Sector</h2>
                <% @sectors.each do |s| %>
                  <div class="checkbox">
                    <label>
                      <input type="checkbox" name="sector[<%= s %>]" value="">
                      <%= s %> (<%= @projects.count{|x|([x.psector]+x.asectors).include?(s)} %>)
                    </label>
                  </div>
                <% end %>
              </div>
              <div class="input-group">
                <h2>Primary Beneficiaries</h2>
                <% @pbens.each do |pb| %>
                  <div class="checkbox">
                    <label>
                      <input type="checkbox" name="sector[<%= pb %>]" value="">
                      <%= pb %> (<%= @projects.count{|x|x.bens.include?(pb)} %>)
                    </label>
                  </div>
                <% end %>
              </div>
            </div>
          </form>
          <a id="showhide">More...</a>
        </div>
      </div>
    </div>
  </div>
</div>
<%= javascript_tag do %>
  var MAP_URL = '<%= APP_CONFIG["mapbox"] %>';
  // The GeoJSON representing the two point features
  var geoJson = {
      type: 'FeatureCollection',
      features: [
      <% @projects.to_enum.with_index.each do |proj, i| %>
      <%= i==0 ? '' : ','%>{
          type: 'Feature',
          properties: {
              title: '<h1><%= proj.name %></h1>',
              description:  '<p>'+
                              '<strong>Implementing Organization:</strong>'+
                              '<span><%= j proj.oversee %></span>'+
                              '<strong>Primary Beneficiaries:</strong>'+
                              '<span><%= j proj.bens.join(", ") %></span>'+
                              '<strong>Sectors:</strong>'+
                              '<span><%= j ([proj.psector]+proj.asectors).join(", ") %></span>'+
                              '<strong>Description:</strong>'+
                              '<span><%= j proj.description %></span>'+
                            '</p>'+
                            '<small>Click <%= link_to 'here', proj %> to see more</small>',
              'marker-color': '#f00',
              'marker-size': 'large',
          },
          geometry: {
              type: 'Point',
              coordinates: <%= proj.location %>
          }
      }
      <% end %>
      ]
  };
<% end %>
<%= javascript_include_tag "home", "data-turbolinks-track" => true %>
